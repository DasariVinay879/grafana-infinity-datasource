<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" href="/grafana-infinity-datasource/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://user-images.githubusercontent.com/153843/108479371-9030bb00-728d-11eb-8ae5-f186c78db64e.png#center"/><link rel="preload" as="image" href="https://user-images.githubusercontent.com/153843/108479976-4b595400-728e-11eb-868e-b2d550f496f3.png#center"/><link rel="preload" as="image" href="https://user-images.githubusercontent.com/153843/108480329-b99e1680-728e-11eb-91f3-38c5585477e2.png#center"/><link rel="preload" as="image" href="https://user-images.githubusercontent.com/153843/108482298-392ce500-7291-11eb-9137-888fc4b3515b.png#center#center"/><link rel="preload" as="image" href="https://user-images.githubusercontent.com/153843/108484741-0cc69800-7294-11eb-956b-8dfb74123301.png#center"/><link rel="stylesheet" href="/grafana-infinity-datasource/_next/static/css/c6729501c94bc17c.css" data-precedence="next"/><link rel="preload" href="/grafana-infinity-datasource/_next/static/chunks/webpack-acc533850910ac6f.js" as="script" fetchPriority="low"/><script src="/grafana-infinity-datasource/_next/static/chunks/fd9d1056-7fa96bc4412ca339.js" async=""></script><script src="/grafana-infinity-datasource/_next/static/chunks/596-582349f5b7d1459d.js" async=""></script><script src="/grafana-infinity-datasource/_next/static/chunks/main-app-f25b44843fd3855a.js" async=""></script><title>Thingspeak API</title><link rel="icon" href="/grafana-infinity-datasource/favicon.ico" type="image/x-icon" sizes="32x32"/><meta name="next-size-adjust"/><script src="/grafana-infinity-datasource/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_1f14df"><div class="relative flex min-h-screen flex-col"><header class="sticky top-0 z-50 w-full border-none  backdrop-blur bg-gray-900 text-gray-100 border-gray-700"><div class="md:container flex gap-2 h-14 sm:items-center"><div class="mr-4 hidden md:flex"><nav class="flex items-center space-x-6 text-sm font-medium"><a class="flex items-center space-x-4 ml-6" href="/grafana-infinity-datasource"><img alt="Grafana Infinity Datasource plugin logo" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="https://raw.githubusercontent.com/grafana/grafana-infinity-datasource/main/src/img/icon.svg"/><span class="hidden sm:inline-block">Grafana Infinity Datasource</span></a><a target="" class="transition-colors text-gray-100 hover:text-gray-200 flex" href="/grafana-infinity-datasource/docs/installation">Docs</a><a target="" class="transition-colors text-gray-100 hover:text-gray-200 flex" href="/grafana-infinity-datasource/blog">Blog &amp; Examples</a><a target="_blank" class="transition-colors text-gray-100 hover:text-gray-200 flex" href="https://github.com/grafana/grafana-infinity-datasource">GitHub<img alt="opening in external tab" loading="lazy" width="12" height="12" decoding="async" data-nimg="1" class="ml-1" style="color:transparent" src="https://www.svgrepo.com/show/510970/external-link.svg"/></a></nav></div><button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input hover:bg-accent hover:text-accent-foreground h-10 p-0 m-0 bg-none bg-transparent outline-none border-none md:hidden" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2da:" data-state="closed"><img alt="open-menu" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" class="m-2 py-6" style="color:transparent" src="https://www.svgrepo.com/show/465523/menu-alt-4.svg"/><span class="sr-only">Toggle Menu</span></button><div class="flex flex-1 items-center justify-between space-x-2 md:justify-end"><div class="w-full flex-1 md:w-auto md:flex-none"><button class="inline-flex items-center rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 relative w-full justify-start text-sm text-muted-foreground bg-gray-800 border-none sm:pr-12 md:w-40 lg:w-64"><span class="hidden lg:inline-flex">Search documentation...</span><span class="inline-flex lg:hidden">Search...</span><kbd class="pointer-events-none absolute right-1.5 top-1.5 hidden h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex"><span class="text-xs">âŒ˜</span>K</kbd></button></div><nav class="flex items-center"><a target="_blank" class="ml-2" href="https://github.com/grafana/grafana-infinity-datasource"><img alt="" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="grayscale hover:grayscale-0" style="color:transparent" src="https://www.svgrepo.com/show/439171/github.svg"/><span class="sr-only">GitHub</span></a><a target="_blank" class="ml-2" href="https://twitter.com/grafanaInfinity"><img alt="" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="grayscale hover:grayscale-0" style="color:transparent" src="https://www.svgrepo.com/show/448252/twitter.svg"/><span class="sr-only">Twitter</span></a><a target="_blank" class="ml-2" href="https://www.youtube.com/playlist?list=PL4vVKeEREln5ub1qrSMrwAabU0FiSNtmC"><img alt="" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="grayscale hover:grayscale-0" style="color:transparent" src="https://www.svgrepo.com/show/448261/youtube.svg"/><span class="sr-only">Youtube</span></a></nav></div></div></header><main class="flex-1"><div><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside class="fixed top-14 z-30 -ml-2 hidden h-[calc(100vh-3.5rem)] w-full shrink-0 md:sticky md:block"><div dir="ltr" class="relative overflow-hidden h-full py-6 pl-8 pr-6 lg:py-8" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div class="w-full"><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Getting Started</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/installation">Installation</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/configuration">Configuration</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/provisioning">Provisioning</a></div></div><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Formats</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/json">JSON</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/csv">CSV</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/xml">XML</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/html">HTML</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/graphql">GraphQL</a></div></div><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Parsers</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/backend">Backend</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/uql">UQL</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/groq">GROQ</a></div></div><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Features</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication">Authentication</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/url">URL Configuration</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/template-variables">Variables</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/filters">Filters</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/macros">Macros</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/annotations">Annotations</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/node-graph">Node Graph</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/time-formats">Time Formats</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/reference-data">Reference Data</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/azure-blob-storage">Azure Blob storage</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/global-queries">Global Queries</a></div></div><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Authentication</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#basic-authentication">Basic auth</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#bearer-token-authentication">Bearer token</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#api-key-authentication">API keys</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#digest-authentication">Digest auth</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#oauth-passthrough">OAuth forwarding</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#oauth2-client-credentials-authentication">OAuth2</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/azure-authentication">Azure</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/aws-authentication">AWS</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/authentication#gcp-authentication">GCP</a></div></div><div class="pb-4"><h4 class="mb-1 rounded-md px-2 py-1 text-sm font-semibold">Other</h4><div class="grid grid-flow-row auto-rows-max text-sm"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/docs/limitations">Known Limitations</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/changelog">Changelog</a><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 hover:bg-slate-200 text-muted-foreground" target="" rel="" href="/grafana-infinity-datasource/license">License</a></div></div></div></div></div></div></aside><main class="relative py-6 lg:gap-10 lg:py-8"><div class="mx-auto w-full min-w-0"><article class="py-1 prose dark:prose-invert"><header><h1 class="mb-2 font-extrabold text-2xl">Thingspeak API</h1><p class="space-x-1 text-xs text-gray-500"></p></header><hr class="my-6"/><div class="markdown-content"><p>In this example, we are going to visualize data from ThingSpeak API.</p>
<p>For demo purpose, I am using <a href="https://thingspeak.com/channels/38629">traffic monitor public channel</a> ( Channel ID : 38629 ). You may know already that, ThingSpeak APIs available in different formats such as JSON, CSV and XML. We are going to see how to use all of those different API formats.</p>
<h2 id="json-example" class="pb-2 font-bold"><a class="anchor" href="#json-example"><span class="icon icon-link"></span></a>JSON Example<a href="#json-example" class="anchor-link ml-2 text-orange-500">#</a></h2>
<p>As you can see in the below picture, I am using the <a href="https://thingspeak.com/channels/38629/feed.json">JSON feed url</a> of the channel. If you look at the JSON schema, my data points are under the node called <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">feeds</code>. So I specify the same as my <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">Rows/Root</code> selector. Then for the columns, we need to first specify our time column which is <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">created_at</code> field in our json feed. Then we can specify one or more metrics(number) fields as shown in the below picture.</p>
<p><img src="https://user-images.githubusercontent.com/153843/108479371-9030bb00-728d-11eb-8ae5-f186c78db64e.png#center" alt="image"/></p>
<h2 id="csv-example" class="pb-2 font-bold"><a class="anchor" href="#csv-example"><span class="icon icon-link"></span></a>CSV Example<a href="#csv-example" class="anchor-link ml-2 text-orange-500">#</a></h2>
<p>If you prefer CSV format over JSON, here is the example settings of the same channel. I am using <a href="https://thingspeak.com/channels/38629/feed.csv">CSV feed url</a> of the channel. In the query, Choose <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">CSV</code> as your type, specify the csv feed URL and then the fields you needed along with time field.</p>
<p><img src="https://user-images.githubusercontent.com/153843/108479976-4b595400-728e-11eb-868e-b2d550f496f3.png#center" alt="image"/></p>
<h2 id="xml-example" class="pb-2 font-bold"><a class="anchor" href="#xml-example"><span class="icon icon-link"></span></a>XML Example<a href="#xml-example" class="anchor-link ml-2 text-orange-500">#</a></h2>
<p>You are not limited to CSV, JSON. You can also use xml format as well in your query if your prefer that. I am using <a href="https://thingspeak.com/channels/38629/feed.xml">XML feed url</a> of the channel. Query setup is almost same as csv/json. Notable configurations are your rows/root field and timestamp field. As you see in the below picture, I am using <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">channel.feeds[0].feed</code> as my root/rows selector and then for selecting timestamp, I use <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">created-at[0]._</code></p>
<p><img src="https://user-images.githubusercontent.com/153843/108480329-b99e1680-728e-11eb-91f3-38c5585477e2.png#center" alt="image"/></p>
<h2 id="using-grafanas-time-filter" class="pb-2 font-bold"><a class="anchor" href="#using-grafanas-time-filter"><span class="icon icon-link"></span></a>Using Grafana&#x27;s time filter<a href="#using-grafanas-time-filter" class="anchor-link ml-2 text-orange-500">#</a></h2>
<p>Once you setup the query, you may find that your are always querying recent data in the graphs irrespective of the time range chosen in Grafana. To solve this issue, we need to pass the Grafana&#x27;s dynamic time range in the url. As per the <a href="https://community.thingspeak.com/documentation%20.../api/">ThingSpeak API specification</a>, you need to pass the start and end time to the url as query string params. To do that, I am appending <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">?start=${__from:date:YYYY-MM-DD HH:NN:SS}&amp;end=${__to:date:YYYY-MM-DD HH:NN:SS}</code> to the url. You can use any variable as specified in the <a href="https://grafana.com/docs/grafana/latest/variables/variable-types/global-variables/">grafana doc</a></p>
<p>My full url now becomes <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">https://thingspeak.com/channels/38629/feed.json?start=${__from:date:YYYY-MM-DD HH:NN:SS}&amp;end=${__to:date:YYYY-MM-DD HH:NN:SS}</code>.</p>
<p><img src="https://user-images.githubusercontent.com/153843/108482298-392ce500-7291-11eb-9137-888fc4b3515b.png#center#center" alt="image"/></p>
<h2 id="long-time-range" class="pb-2 font-bold"><a class="anchor" href="#long-time-range"><span class="icon icon-link"></span></a>Long time range<a href="#long-time-range" class="anchor-link ml-2 text-orange-500">#</a></h2>
<p>Typically for up to 2 hour you can get all the metrics without any aggregation. If you are looking for more long time range, you may need to pass aggregation filter to your url. Here in the below example, I am looking for data worth of recent 180days. So i am pulling the aggregated data using the url <code class="relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm">https://thingspeak.com/channels/38629/feed.json?start=${__from:date:YYYY-MM-DD HH:NN:SS}&amp;end=${__to:date:YYYY-MM-DD HH:NN:SS}&amp;average=1440</code> the key to look at here is <strong>average=1440</strong> where it specify to take average of each 1440 minutes/1day. You can specify more granular time aggregation. As per the document, 10, 15, 20, 30, 60, 240, 720, 1440 are the valid time range in minutes. Also instead average you can use sum/timescale/median functions.</p>
<p><img src="https://user-images.githubusercontent.com/153843/108484741-0cc69800-7294-11eb-956b-8dfb74123301.png#center" alt="image"/></p>
<h2 id="note" class="pb-2 font-bold"><a class="anchor" href="#note"><span class="icon icon-link"></span></a>Note<a href="#note" class="anchor-link ml-2 text-orange-500">#</a></h2>
<blockquote class="mt-6 border-l-2 pl-6 italic">
<p>This post was originally posted in <a href="https://github.com/grafana/grafana-infinity-datasource/discussions/38">github discussion</a></p>
</blockquote></div></article></div></main></div></div></main><footer class="py-6 border-t-1 border-gray-700 text-center bg-gray-800"><div class="container flex flex-col items-center justify-between gap-4 md:flex-row"><p class="text-center text-sm leading-loose text-muted-foreground w-full">Copyright Â© 2023 Grafana Labs</p></div></footer></div><script src="/grafana-infinity-datasource/_next/static/chunks/webpack-acc533850910ac6f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/grafana-infinity-datasource/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/grafana-infinity-datasource/_next/static/css/c6729501c94bc17c.css\",{\"as\":\"style\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-acc533850910ac6f.js\",\"971:static/chunks/fd9d1056-7fa96bc4412ca339.js\",\"596:static/chunks/596-582349f5b7d1459d.js\"],\"name\":\"default\",\"async\":false}\n6:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-acc533850910ac6f.js\",\"971:static/chunks/fd9d1056-7fa96bc4412ca339.js\",\"596:static/chunks/596-582349f5b7d1459d.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":3189,\"chunks\":[\"310:static/chunks/0e5ce63c-ef4c11e95cfe58be.js\",\"222:static/chunks/222-61f75ea56c49879c.js\",\"413:s"])</script><script>self.__next_f.push([1,"tatic/chunks/413-95877600faafadc3.js\",\"685:static/chunks/685-b14093ee69651263.js\",\"394:static/chunks/394-9ae0597d4a2d05bc.js\",\"185:static/chunks/app/layout-6a90743b40cdcb3e.js\"],\"name\":\"\",\"async\":false}\n8:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-acc533850910ac6f.js\",\"971:static/chunks/fd9d1056-7fa96bc4412ca339.js\",\"596:static/chunks/596-582349f5b7d1459d.js\"],\"name\":\"default\",\"async\":false}\n9:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-acc533850910ac6f.js\",\"971:static/chunks/fd9d1056-7fa96bc4412"])</script><script>self.__next_f.push([1,"ca339.js\",\"596:static/chunks/596-582349f5b7d1459d.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/grafana-infinity-datasource/_next/static/css/c6729501c94bc17c.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"fw_Nv5hd1PoS3TEQdwOGx\",\"assetPrefix\":\"/grafana-infinity-datasource\",\"initialCanonicalUrl\":\"/blog/01-thingspeak\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"01-thingspeak\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"01-thingspeak\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":\"$L5\",\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"$L7\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"text-center m-auto ml-[30%] my-[25%]\",\"children\":\"Sorry..! Page not found.\"}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"01-thingspeak\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$La\",\"$Lb\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"01-thingspeak\\\"]}\"},\"styles\":[]}],\"segment\":[\"slug\",\"01-thingspeak\",\"c\"]},\"styles\":[]}],\"segment\":\"blog\"},\"styles\":[]}],\"params\":{}}],null]}]]\n"])</script><script>self.__next_f.push([1,"c:I{\"id\":4785,\"chunks\":[\"222:static/chunks/222-61f75ea56c49879c.js\",\"413:static/chunks/413-95877600faafadc3.js\",\"797:static/chunks/app/blog/[...slug]/page-948162a869f2343b.js\"],\"name\":\"Mdx\",\"async\":false}\nd:T1cf1,"])</script><script>self.__next_f.push([1,"var Component=(()=\u003e{var d=Object.create;var s=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var f=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=\u003e{for(var t in e)s(a,t,{get:e[t],enumerable:!0})},r=(a,e,t,o)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let i of g(e))!p.call(a,i)\u0026\u0026i!==t\u0026\u0026s(a,i,{get:()=\u003ee[i],enumerable:!(o=m(e,i))||o.enumerable});return a};var b=(a,e,t)=\u003e(t=a!=null?d(u(a)):{},r(e||!a||!a.__esModule?s(t,\"default\",{value:a,enumerable:!0}):t,a)),N=a=\u003er(s({},\"__esModule\",{value:!0}),a);var l=f((_,c)=\u003e{c.exports=_jsx_runtime});var x={};y(x,{default:()=\u003eY,frontmatter:()=\u003ek});var n=b(l()),k={slug:\"/blog/thingspeak\",title:\"Thingspeak API\",date:\"2022-01-28\",tags:[\"blog\",\"iot\",\"tutorial\",\"example\",\"thingspeak\",\"json\",\"csv\",\"xml\"]};function h(a){let e=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",code:\"code\",img:\"img\",strong:\"strong\",blockquote:\"blockquote\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"In this example, we are going to visualize data from ThingSpeak API.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"For demo purpose, I am using \",(0,n.jsx)(e.a,{href:\"https://thingspeak.com/channels/38629\",children:\"traffic monitor public channel\"}),\" ( Channel ID : 38629 ). You may know already that, ThingSpeak APIs available in different formats such as JSON, CSV and XML. We are going to see how to use all of those different API formats.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"json-example\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#json-example\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"JSON Example\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"As you can see in the below picture, I am using the \",(0,n.jsx)(e.a,{href:\"https://thingspeak.com/channels/38629/feed.json\",children:\"JSON feed url\"}),\" of the channel. If you look at the JSON schema, my data points are under the node called \",(0,n.jsx)(e.code,{children:\"feeds\"}),\". So I specify the same as my \",(0,n.jsx)(e.code,{children:\"Rows/Root\"}),\" selector. Then for the columns, we need to first specify our time column which is \",(0,n.jsx)(e.code,{children:\"created_at\"}),\" field in our json feed. Then we can specify one or more metrics(number) fields as shown in the below picture.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://user-images.githubusercontent.com/153843/108479371-9030bb00-728d-11eb-8ae5-f186c78db64e.png#center\",alt:\"image\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"csv-example\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#csv-example\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"CSV Example\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you prefer CSV format over JSON, here is the example settings of the same channel. I am using \",(0,n.jsx)(e.a,{href:\"https://thingspeak.com/channels/38629/feed.csv\",children:\"CSV feed url\"}),\" of the channel. In the query, Choose \",(0,n.jsx)(e.code,{children:\"CSV\"}),\" as your type, specify the csv feed URL and then the fields you needed along with time field.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://user-images.githubusercontent.com/153843/108479976-4b595400-728e-11eb-868e-b2d550f496f3.png#center\",alt:\"image\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"xml-example\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#xml-example\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"XML Example\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You are not limited to CSV, JSON. You can also use xml format as well in your query if your prefer that. I am using \",(0,n.jsx)(e.a,{href:\"https://thingspeak.com/channels/38629/feed.xml\",children:\"XML feed url\"}),\" of the channel. Query setup is almost same as csv/json. Notable configurations are your rows/root field and timestamp field. As you see in the below picture, I am using \",(0,n.jsx)(e.code,{children:\"channel.feeds[0].feed\"}),\" as my root/rows selector and then for selecting timestamp, I use \",(0,n.jsx)(e.code,{children:\"created-at[0]._\"})]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://user-images.githubusercontent.com/153843/108480329-b99e1680-728e-11eb-91f3-38c5585477e2.png#center\",alt:\"image\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"using-grafanas-time-filter\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#using-grafanas-time-filter\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using Grafana's time filter\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Once you setup the query, you may find that your are always querying recent data in the graphs irrespective of the time range chosen in Grafana. To solve this issue, we need to pass the Grafana's dynamic time range in the url. As per the \",(0,n.jsx)(e.a,{href:\"https://community.thingspeak.com/documentation%20.../api/\",children:\"ThingSpeak API specification\"}),\", you need to pass the start and end time to the url as query string params. To do that, I am appending \",(0,n.jsx)(e.code,{children:\"?start=${__from:date:YYYY-MM-DD HH:NN:SS}\u0026end=${__to:date:YYYY-MM-DD HH:NN:SS}\"}),\" to the url. You can use any variable as specified in the \",(0,n.jsx)(e.a,{href:\"https://grafana.com/docs/grafana/latest/variables/variable-types/global-variables/\",children:\"grafana doc\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My full url now becomes \",(0,n.jsx)(e.code,{children:\"https://thingspeak.com/channels/38629/feed.json?start=${__from:date:YYYY-MM-DD HH:NN:SS}\u0026end=${__to:date:YYYY-MM-DD HH:NN:SS}\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://user-images.githubusercontent.com/153843/108482298-392ce500-7291-11eb-9137-888fc4b3515b.png#center#center\",alt:\"image\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"long-time-range\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#long-time-range\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Long time range\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Typically for up to 2 hour you can get all the metrics without any aggregation. If you are looking for more long time range, you may need to pass aggregation filter to your url. Here in the below example, I am looking for data worth of recent 180days. So i am pulling the aggregated data using the url \",(0,n.jsx)(e.code,{children:\"https://thingspeak.com/channels/38629/feed.json?start=${__from:date:YYYY-MM-DD HH:NN:SS}\u0026end=${__to:date:YYYY-MM-DD HH:NN:SS}\u0026average=1440\"}),\" the key to look at here is \",(0,n.jsx)(e.strong,{children:\"average=1440\"}),\" where it specify to take average of each 1440 minutes/1day. You can specify more granular time aggregation. As per the document, 10, 15, 20, 30, 60, 240, 720, 1440 are the valid time range in minutes. Also instead average you can use sum/timescale/median functions.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://user-images.githubusercontent.com/153843/108484741-0cc69800-7294-11eb-956b-8dfb74123301.png#center\",alt:\"image\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"note\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#note\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Note\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"This post was originally posted in \",(0,n.jsx)(e.a,{href:\"https://github.com/grafana/grafana-infinity-datasource/discussions/38\",children:\"github discussion\"})]}),`\n`]})]})}function S(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(h,a)})):h(a)}var Y=S;return N(x);})();\n;return Component;"])</script><script>self.__next_f.push([1,"b:[\"$\",\"article\",null,{\"className\":\"py-1 prose dark:prose-invert\",\"children\":[\"$undefined\",[\"$\",\"header\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2 font-extrabold text-2xl\",\"children\":\"Thingspeak API\"}],\"$undefined\",[\"$\",\"p\",null,{\"className\":\"space-x-1 text-xs text-gray-500\"}]]}],[\"$\",\"hr\",null,{\"className\":\"my-6\"}],[\"$\",\"div\",null,{\"className\":\"markdown-content\",\"children\":[\"$\",\"$Lc\",null,{\"code\":\"$d\"}]}]]}]\n5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Thingspeak API\"}],["])</script><script>self.__next_f.push([1,"\"$\",\"meta\",\"2\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/grafana-infinity-datasource/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\na:null\n"])</script></body></html>